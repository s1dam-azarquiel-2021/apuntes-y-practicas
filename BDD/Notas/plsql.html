<!DOCTYPE html>
<html lang="es">
<head>
<!-- 2022-04-18 Mon 19:09 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PLSQL</title>
<meta name="author" content="Alberto Robles Gomez" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="../../css/index.css" />
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">PLSQL</h1>
</header><p>
Numeros del 100 al 1:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  lanzamiento <span class="org-keyword">NUMBER</span>(3) := 100;
<span class="org-keyword">BEGIN</span>
  WHILE lanzamiento &gt; 0 LOOP
    dbms_output.put( lanzamiento || <span class="org-string">' '</span> );
    lanzamiento := lanzamiento - 1;
  <span class="org-keyword">END</span> LOOP;

  dbms_output.put_line( <span class="org-string">''</span> );
  dbms_output.put_line( <span class="org-string">'acabo el bucle'</span> );
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Pedir un numero y mostrar sus divisores y si es primo:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  numero <span class="org-keyword">NUMBER</span>(5) := 0;
  divisores <span class="org-keyword">NUMBER</span>(5) := 0;
<span class="org-keyword">BEGIN</span>
  numero := &amp;1;
  dbms_output.put_line( <span class="org-string">'Divisores de '</span> || numero || <span class="org-string">':'</span> );

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> 1 .. numero LOOP
    IF <span class="org-builtin">MOD</span>(numero, i) = 0 <span class="org-keyword">THEN</span>
      dbms_output.put_line( i );
      divisores := divisores + 1;
    <span class="org-keyword">END</span> IF;
  <span class="org-keyword">END</span> LOOP;

  IF divisores &lt; 3 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'El numero es primo'</span> );
  <span class="org-keyword">ELSE</span>
    dbms_output.put_line( <span class="org-string">'El numero no es primo'</span> );
  <span class="org-keyword">END</span> IF;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Programa que admite una nota y nos dice con palabras la nota:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  nota <span class="org-keyword">NUMBER</span>(3,1);
<span class="org-keyword">BEGIN</span>
  nota := &amp;1;

  IF nota &lt; 0 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Tan penoso que tiene nota negativa'</span> );
  ELSIF nota &lt; 3 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Muy deficiente'</span> );
  ELSIF nota &lt; 5 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Insuficiente'</span> );
  ELSIF nota &lt; 6 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Suficiente'</span> );
  ELSIF nota &lt; 7 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Bien'</span> );
  ELSIF nota &lt; 9 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Notable'</span> );
  ELSIF nota &lt;= 10 <span class="org-keyword">THEN</span>
    dbms_output.put_line( <span class="org-string">'Sobresaliente'</span> );
  <span class="org-keyword">ELSE</span>
    dbms_output.put_line( <span class="org-string">'Vaya nota mas rara tienes'</span> );
  <span class="org-keyword">END</span> IF;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Visualizar los 10 ultimos multiplos de 7 menores de 1000
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  ultimoMultiplo <span class="org-keyword">NUMBER</span>(3) := 0;
  desde <span class="org-keyword">NUMBER</span>(3) := 999;
  multiplo <span class="org-keyword">NUMBER</span>(1) := 7;
  cantidad <span class="org-keyword">NUMBER</span>(2) := 10;
<span class="org-keyword">BEGIN</span>
  WHILE ultimoMultiplo = 0 LOOP
    IF <span class="org-builtin">MOD</span>(desde, multiplo) = 0 <span class="org-keyword">THEN</span>
      ultimoMultiplo := desde;
    <span class="org-keyword">ELSE</span>
      desde := desde - 1;
    <span class="org-keyword">END</span> IF;
  <span class="org-keyword">END</span> LOOP;

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> 1 .. cantidad LOOP
    dbms_output.put_line( ultimoMultiplo );
    ultimoMultiplo := ultimoMultiplo - multiplo;
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Numeros capicuas desde el 1000 hasta el 9999 (de 4 cifras):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> 1000 .. 9999 LOOP
    IF TRUNC(i / 100) = <span class="org-builtin">MOD</span>(i, 10) * 10 + <span class="org-builtin">MOD</span>(TRUNC(i / 10), 10) <span class="org-keyword">THEN</span>
      dbms_output.put_line( i );
    <span class="org-keyword">END</span> IF;
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Crear un reloj digital:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> 0 .. 23 LOOP
    <span class="org-keyword">FOR</span> j <span class="org-keyword">IN</span> 0 .. 59 LOOP
      dbms_output.put_line( LPAD(i, 2, <span class="org-string">'0'</span>) || <span class="org-string">':'</span> || LPAD(j, 2, <span class="org-string">'0'</span>) );
    <span class="org-keyword">END</span> LOOP;
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Programa que acepta un numero de 5 digitos y visualiza cuantos
divisores tieney cuales son:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  numero <span class="org-keyword">NUMBER</span>(5) := 0;
  raiz <span class="org-keyword">NUMBER</span>(3) := 0;
  total <span class="org-keyword">NUMBER</span>(3) := 0;
  i <span class="org-keyword">NUMBER</span>(5) := 1;
<span class="org-keyword">BEGIN</span>
  numero := &amp;1;
  raiz := SQRT(numero);

  WHILE i &lt; TRUNC(numero / 2) <span class="org-keyword">AND</span> <span class="org-keyword">NOT</span> (i &gt; raiz <span class="org-keyword">AND</span> total = 0) LOOP
    IF <span class="org-builtin">MOD</span>(numero, i) = 0 <span class="org-keyword">THEN</span>
      dbms_output.put_line(i);
      total := total + 1;
    <span class="org-keyword">END</span> IF;
    i := i + 1;
  <span class="org-keyword">END</span> LOOP;

  IF numero &gt; 1 <span class="org-keyword">THEN</span>
    dbms_output.put_line(numero);
    total := total + 1;
  <span class="org-keyword">END</span> IF;

  dbms_output.put_line( <span class="org-string">'Numero de divisores: '</span> || total );
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Listado de numeros primos hasta 100.000:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span> <span class="org-keyword">SIZE</span> UNLIMITED;

<span class="org-keyword">DECLARE</span>
  i <span class="org-keyword">NUMBER</span> := 3;
  j <span class="org-keyword">NUMBER</span>;
  esPrimo <span class="org-type">BOOLEAN</span>;
<span class="org-keyword">BEGIN</span>
  dbms_output.put_line(1);
  dbms_output.put_line(2);

  WHILE i &lt; 100000 LOOP
    j := 3;
    esPrimo := <span class="org-keyword">TRUE</span>;

    WHILE esPrimo <span class="org-keyword">AND</span> j &lt;= SQRT(i) LOOP
      IF <span class="org-builtin">MOD</span>(i, j) = 0 <span class="org-keyword">THEN</span>
        esPrimo := <span class="org-keyword">FALSE</span>;
      <span class="org-keyword">ELSE</span>
        j := j + 2;
      <span class="org-keyword">END</span> IF;
    <span class="org-keyword">END</span> LOOP;

    IF esPrimo <span class="org-keyword">THEN</span>
      dbms_output.put_line(i);
    <span class="org-keyword">END</span> IF;

    i := i + 2;
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Insertar 100 registros en paises con distinto nombre.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  ultimoID <span class="org-keyword">NUMBER</span>(3);
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> NVL(<span class="org-builtin">MAX</span>(c_pais), 0) + 1 <span class="org-keyword">INTO</span> ultimoID <span class="org-keyword">FROM</span> paises;
  <span class="org-keyword">for</span> i <span class="org-keyword">IN</span> 1 .. 100 LOOP
    <span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> paises (c_pais, nombre_pais) <span class="org-keyword">VALUES</span> (i + ultimoID, <span class="org-string">'Pepino '</span> || i);
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Mostrar todos los titulos de las peliculas.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  c_min <span class="org-keyword">NUMBER</span>(4,0);
  c_max <span class="org-keyword">NUMBER</span>(4,0);
  titulo VARCHAR2(16);
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> <span class="org-builtin">MIN</span>(c_peli), <span class="org-builtin">MAX</span>(c_peli)
  <span class="org-keyword">INTO</span>   c_min, c_max
  <span class="org-keyword">FROM</span>   peliculas;

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> c_min .. c_max LOOP
    <span class="org-keyword">SELECT</span> titulo <span class="org-keyword">INTO</span> titulo <span class="org-keyword">FROM</span> peliculas <span class="org-keyword">WHERE</span> c_peli = i;
    dbms_output.put_line( titulo );
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Visualizar todos los campos de datos de los socios.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  c_min <span class="org-keyword">NUMBER</span>(4,0);
  c_max <span class="org-keyword">NUMBER</span>(4,0);
  nombre VARCHAR2(15);
  ape1 VARCHAR2(15);
  ape2 VARCHAR2(15);
  direccion VARCHAR2(20);
  telefono <span class="org-type">CHAR</span>(9);
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> <span class="org-builtin">MIN</span>(c_socio), <span class="org-builtin">MAX</span>(c_socio)
  <span class="org-keyword">INTO</span>   c_min, c_max
  <span class="org-keyword">FROM</span>   socios;

  dbms_output.put_line(
    <span class="org-string">'| CODIGO '</span>
    || RPAD(<span class="org-string">'| NOMBRE'</span>, 18)
    || RPAD(<span class="org-string">'| APE1'</span>, 18)
    || RPAD(<span class="org-string">'| APE2'</span>, 18)
    || RPAD(<span class="org-string">'| DIRECCION'</span>, 23)
    || RPAD(<span class="org-string">'| TELEFONO'</span>, 12)
    || <span class="org-string">'|'</span>
  );

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> c_min .. c_max LOOP
    dbms_output.put_line(RPAD(<span class="org-string">'-'</span>,99,<span class="org-string">'-'</span>));

    <span class="org-keyword">SELECT</span> nombre, ape1, ape2, direccion, telefono
    <span class="org-keyword">INTO</span>   nombre, ape1, ape2, direccion, telefono
    <span class="org-keyword">FROM</span>   socios
    <span class="org-keyword">WHERE</span>  c_socio = i;

    dbms_output.put_line(
      RPAD(<span class="org-string">'| '</span> || i, 9)
      || RPAD(<span class="org-string">'| '</span> || nombre, 18)
      || RPAD(<span class="org-string">'| '</span> || ape1, 18)
      || RPAD(<span class="org-string">'| '</span> || ape2, 18)
      || RPAD(<span class="org-string">'| '</span> || direccion, 23)
      || RPAD(<span class="org-string">'| '</span> || telefono, 12)
      || <span class="org-string">'|'</span>
    );
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Visualizar los titulos de las peliculas que se han alquilado, junto
con la fecha del ultimo alquiler.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  c_min <span class="org-keyword">NUMBER</span>(4,0);
  c_max <span class="org-keyword">NUMBER</span>(4,0);
  titulo VARCHAR2(16);
  fecha <span class="org-type">DATE</span>;
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> <span class="org-builtin">MIN</span>(c_peli), <span class="org-builtin">MAX</span>(c_peli)
  <span class="org-keyword">INTO</span>   c_min, c_max
  <span class="org-keyword">FROM</span>   peliculas;

  dbms_output.put_line(RPAD(<span class="org-string">'TITULO'</span>, 16) || <span class="org-string">' | FECHA'</span>);
  dbms_output.put_line(RPAD(<span class="org-string">'-'</span>,27,<span class="org-string">'-'</span>));

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> c_min .. c_max LOOP
    <span class="org-keyword">SELECT</span> titulo, (
      <span class="org-keyword">SELECT</span> <span class="org-builtin">MAX</span>(fecha)
      <span class="org-keyword">FROM</span>   alquiler
      <span class="org-keyword">WHERE</span>  c_peli = p.c_peli
    )
    <span class="org-keyword">INTO</span>   titulo, fecha
    <span class="org-keyword">FROM</span>   peliculas p
    <span class="org-keyword">WHERE</span>  c_peli = i;

    IF fecha <span class="org-keyword">IS</span> <span class="org-keyword">NOT</span> <span class="org-keyword">NULL</span> <span class="org-keyword">THEN</span>
      dbms_output.put_line(
        RPAD(titulo, 16)
        || <span class="org-string">' | '</span>
        || fecha
      );
    <span class="org-keyword">END</span> IF;
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Listado con todos los articulos de la BD VENTAS junto con cuantas
ventas hay de cada uno de ellos, su precio y de que provincia vienen.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  c_min <span class="org-keyword">NUMBER</span>(3,0);
  c_max <span class="org-keyword">NUMBER</span>(3,0);
  ventas <span class="org-keyword">NUMBER</span>(5);
  precio <span class="org-keyword">NUMBER</span>(4,0);
  provincia VARCHAR2(12);
  articulo VARCHAR2(15);
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> <span class="org-builtin">MIN</span>(c_art), <span class="org-builtin">MAX</span>(c_art)
  <span class="org-keyword">INTO</span>   c_min, c_max
  <span class="org-keyword">FROM</span>   articulo;

  dbms_output.put_line(
    RPAD(<span class="org-string">'| ARTICULO'</span>, 18)
    || <span class="org-string">'| PRECIO '</span>
    || <span class="org-string">'| VENTAS '</span>
    || RPAD(<span class="org-string">'| PROVINCIA'</span>, 15)
    || <span class="org-string">'|'</span>
  );
  dbms_output.put_line(RPAD(<span class="org-string">'-'</span>,52,<span class="org-string">'-'</span>));

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> c_min .. c_max LOOP
    <span class="org-keyword">SELECT</span>  precio, descrip, (
      <span class="org-keyword">SELECT</span>   <span class="org-builtin">SUM</span>(cantidad)
      <span class="org-keyword">FROM</span>     ventas
      <span class="org-keyword">WHERE</span>    c_art = i
      <span class="org-keyword">GROUP</span> <span class="org-keyword">BY</span> c_art
    ), (
      <span class="org-keyword">SELECT</span> provincia
      <span class="org-keyword">FROM</span>   proveedor
      <span class="org-keyword">WHERE</span>  c_provee = a.c_provee
    )
    <span class="org-keyword">INTO</span>  precio, articulo, ventas, provincia
    <span class="org-keyword">FROM</span>  articulo a
    <span class="org-keyword">WHERE</span> c_art = i;

    dbms_output.put_line(
      <span class="org-string">'| '</span> || RPAD(articulo, 15)
      || <span class="org-string">' | '</span> || RPAD(precio, 6)
      || <span class="org-string">' | '</span> || RPAD(ventas, 6)
      || <span class="org-string">' | '</span> || RPAD(provincia, 12)
      || <span class="org-string">' |'</span>
    );
    dbms_output.put_line(RPAD(<span class="org-string">'-'</span>,52,<span class="org-string">'-'</span>));
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Visualizar los 3 articulos que m√°s cantidad hemos vendido.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  articulo VARCHAR2(15);
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> 1 .. 3 LOOP
    <span class="org-keyword">SELECT</span> nombre
    <span class="org-keyword">INTO</span>   articulo
    <span class="org-keyword">FROM</span> (
      <span class="org-keyword">SELECT</span> nombre, rownum <span class="org-keyword">as</span> fila
      <span class="org-keyword">FROM</span> (
        <span class="org-keyword">SELECT</span>   descrip <span class="org-keyword">as</span> nombre
        <span class="org-keyword">FROM</span>     articulo a
        <span class="org-keyword">ORDER</span> <span class="org-keyword">BY</span> (
          <span class="org-keyword">SELECT</span> <span class="org-builtin">SUM</span>(cantidad)
          <span class="org-keyword">FROM</span>   ventas
          <span class="org-keyword">WHERE</span>  c_art = a.c_art
        ) <span class="org-keyword">DESC</span>
      )
    )
    <span class="org-keyword">WHERE</span> fila = i;

    dbms_output.put_line( articulo );
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DROP</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">gangastoledo</span>;
<span class="org-keyword">CREATE</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">gangastoledo</span> (
  codigo <span class="org-keyword">NUMBER</span>(3) <span class="org-keyword">NOT</span> <span class="org-keyword">NULL</span>,
  nombre VARCHAR2(15),
  precio <span class="org-keyword">NUMBER</span>(6),
  origen VARCHAR2(12),
  cuantas_ven <span class="org-keyword">NUMBER</span>(4),
  cuantos_cli <span class="org-keyword">NUMBER</span>(4),
  <span class="org-keyword">CONSTRAINT</span> pk_codigo_gangas <span class="org-keyword">PRIMARY</span> <span class="org-keyword">KEY</span>(codigo)
);

<span class="org-keyword">DECLARE</span>
  c_min <span class="org-keyword">NUMBER</span>(3);
  c_max <span class="org-keyword">NUMBER</span>(3);
  codigo <span class="org-keyword">NUMBER</span>(3);
  articulo VARCHAR2(15);
  precio <span class="org-keyword">NUMBER</span>(6);
  proveedor VARCHAR2(15);
  n_ven <span class="org-keyword">NUMBER</span>(4);
  n_cli <span class="org-keyword">NUMBER</span>(4);
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> <span class="org-builtin">MIN</span>(c_art), <span class="org-builtin">MAX</span>(c_art)
  <span class="org-keyword">INTO</span>   c_min, c_max
  <span class="org-keyword">FROM</span>   articulo;

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> c_min .. c_max LOOP
    <span class="org-keyword">SELECT</span> c_art, descrip, precio, (
      <span class="org-keyword">SELECT</span> n_prov
      <span class="org-keyword">FROM</span>   proveedor
      <span class="org-keyword">WHERE</span>  c_provee = a.c_provee
    ), (
      <span class="org-keyword">SELECT</span> <span class="org-builtin">COUNT</span>(c_factura)
      <span class="org-keyword">FROM</span>   ventas
      <span class="org-keyword">WHERE</span>  c_art = a.c_art
    ), (
      <span class="org-keyword">SELECT</span> <span class="org-builtin">COUNT</span>(<span class="org-keyword">DISTINCT</span> c_cliente)
      <span class="org-keyword">FROM</span>   ventas
      <span class="org-keyword">WHERE</span>  c_art = a.c_art
    )
    <span class="org-keyword">INTO</span>   codigo, articulo, precio, proveedor, n_ven, n_cli
    <span class="org-keyword">FROM</span>   articulo a
    <span class="org-keyword">WHERE</span>  c_art = i;

    <span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> gangastoledo
    <span class="org-keyword">VALUES</span> (
      codigo, articulo, precio, proveedor, n_ven, n_cli
    );
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>

<p>
Listar nombre area, nombre instituto ganador, instituto que mas puntos
tiene, puntos obtenidos.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SET</span> serveroutput <span class="org-keyword">ON</span>;

<span class="org-keyword">DECLARE</span>
  c_min <span class="org-keyword">NUMBER</span>(2);
  c_max <span class="org-keyword">NUMBER</span>(2);
  area VARCHAR2(25);
  ganador VARCHAR2(25);
  institutoMasPuntos VARCHAR2(25);
  masPuntos <span class="org-keyword">NUMBER</span>;
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">SELECT</span> <span class="org-builtin">MIN</span>(c_area), <span class="org-builtin">MAX</span>(c_area)
  <span class="org-keyword">INTO</span>   c_min, c_max
  <span class="org-keyword">FROM</span>   area;

  dbms_output.put_line(
    RPAD(<span class="org-string">'| AREA '</span>, 20)
    || RPAD(<span class="org-string">'| GANADOR'</span>, 20)
    || RPAD(<span class="org-string">'| MAS PUNTOS'</span>, 20)
    || <span class="org-string">'| PUNTOS |'</span>
  );
  dbms_output.put_line(RPAD(<span class="org-string">'-'</span>,70,<span class="org-string">'-'</span>));

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> c_min .. c_max LOOP
    <span class="org-keyword">SELECT</span>   <span class="org-builtin">MAX</span>(<span class="org-builtin">SUM</span>(ptos))
    <span class="org-keyword">INTO</span>     masPuntos
    <span class="org-keyword">FROM</span>     alumno al, participa pa
    <span class="org-keyword">WHERE</span>    c_area = i
      <span class="org-keyword">AND</span>    al.dni = pa.dni
    <span class="org-keyword">GROUP</span> <span class="org-keyword">BY</span> ies;

    <span class="org-keyword">SELECT</span> descrip, (
      <span class="org-keyword">SELECT</span> nombre_i
      <span class="org-keyword">FROM</span>   instituto
      <span class="org-keyword">WHERE</span>  ies = a.ies_ganador
    ), (
      <span class="org-keyword">SELECT</span> nombre_i
      <span class="org-keyword">FROM</span>   instituto
      <span class="org-keyword">WHERE</span>  ies = (
        <span class="org-keyword">SELECT</span>   ies
        <span class="org-keyword">FROM</span>     alumno al, participa pa
        <span class="org-keyword">WHERE</span>    c_area = i
          <span class="org-keyword">AND</span>    al.dni = pa.dni
        <span class="org-keyword">GROUP</span> <span class="org-keyword">BY</span> ies
        <span class="org-keyword">HAVING</span>   <span class="org-builtin">SUM</span>(ptos) = masPuntos
      )
    )
    <span class="org-keyword">INTO</span>   area, ganador, institutoMasPuntos
    <span class="org-keyword">FROM</span>   area a
    <span class="org-keyword">WHERE</span>  c_area = i;

    dbms_output.put_line(
      RPAD(<span class="org-string">'| '</span> || area, 20)
      || RPAD(<span class="org-string">'| '</span> || ganador, 20)
      || RPAD(<span class="org-string">'| '</span> || institutoMasPuntos, 20)
      || RPAD(<span class="org-string">'| '</span> || masPuntos, 8)
      || <span class="org-string">' |'</span>
    );
    dbms_output.put_line(RPAD(<span class="org-string">'-'</span>,70,<span class="org-string">'-'</span>));
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;
</pre>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Alberto Robles Gomez</p>
<p class="date">Created: 2022-04-18 Mon 19:09</p>
</div>
</body>
</html>
