<!DOCTYPE html>
<html lang="es">
<head>
<!-- 2022-02-28 Mon 19:36 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Practica 5A</title>
<meta name="author" content="Alberto Robles Gomez" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="../../css/index.css" />
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Practica 5A</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>&Iacute;ndice</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org62e83a3">Scripts iniciales I</a></li>
<li><a href="#org6542be6">Scripts Iniciales II</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org62e83a3" class="outline-2">
<h2 id="org62e83a3">Scripts iniciales I</h2>
<div class="outline-text-2" id="text-org62e83a3">
<ol class="org-ol">
<li><p>
Crea un script parametros.sh que nos diga el número de parámetros
pasados por línea de comando y que nos muestre por pantalla dichos
comandos.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">parametros.sh</span>
<span class="org-builtin">echo</span> <span class="org-string">"Numero de parametros:"</span> $<span class="org-variable-name">#</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">@</span>
<span class="org-builtin">echo</span> <span class="org-string">"-----"</span>

<span class="org-keyword">for</span> parameter<span class="org-keyword"> in</span> $<span class="org-variable-name">@</span>
<span class="org-keyword">do</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">parameter</span>
<span class="org-keyword">done</span>
</pre>
</div></li>

<li><p>
Crea un script suma.sh al cual le pasemos dos números por línea de
comando y nos los sume.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">suma.sh</span>
<span class="org-builtin">echo</span> <span class="org-string">"Suma:"</span> $(($<span class="org-variable-name">1</span> + $<span class="org-variable-name">2</span>))
</pre>
</div></li>

<li><p>
Modifica el script anterior para que en caso de que no le pasemos
ningún parámetro nos los solicite de modo interactivo. Si le
pasamos un solo parámetro nos solicitará el otro número a sumar. Si
le pasamos más de dos parámetros nos dirá que el uso es incorrecto
y nos mostrará la ayuda del comando.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">suma_v2.sh</span>
<span class="org-variable-name">n1</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">n2</span>=$<span class="org-variable-name">2</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 1 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Introduce el primer numero: "</span>
<span class="org-builtin">read</span> n1
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 2 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Introduce el segundo numero: "</span>
<span class="org-builtin">read</span> n2
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -gt 2 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> <span class="org-string">"Solo puedes pasar 2 numeros."</span>
<span class="org-keyword">else</span>
<span class="org-builtin">echo</span> <span class="org-string">"Suma:"</span> $(($<span class="org-variable-name">n1</span> + $<span class="org-variable-name">n2</span>))
<span class="org-keyword">fi</span>
</pre>
</div></li>

<li><p>
Crea un script sumaparametros.sh que nos sume todos los parámetros
pasados por línea de comando y nos muestre el resultado. Si no se
pasa ningún parámetro nos mostrará una ayuda de cómo usarlo.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">sumaparametros.sh</span>
[[ $<span class="org-variable-name">#</span> -eq 0 ]] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Tienes que meter al menos 1 numero."</span> &amp;&amp; <span class="org-keyword">exit</span> 1

<span class="org-variable-name">suma</span>=0
<span class="org-keyword">for</span> n<span class="org-keyword"> in</span> $<span class="org-variable-name">@</span>
<span class="org-keyword">do</span>
<span class="org-variable-name">suma</span>=$(($<span class="org-variable-name">suma</span> + $<span class="org-variable-name">n</span>))
<span class="org-keyword">done</span>

<span class="org-builtin">echo</span> <span class="org-string">"Suma:"</span> $<span class="org-variable-name">suma</span>
</pre>
</div></li>

<li><p>
Escribe un script divisible.sh al que nos diga si un número es
divisible por otro número. Para ello el script puede aceptar
parámetros de entrada por línea de comando o solicitar dichos
parámetros al usuario. La forma de uso será.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">divisible.sh</span>
[[ $<span class="org-variable-name">#</span> -gt 2 ]] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Puedes pasar como maximo 2 numeros."</span> &amp;&amp; <span class="org-keyword">exit</span> 1

<span class="org-variable-name">n1</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">n2</span>=$<span class="org-variable-name">2</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 1 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Introduce el primer numero: "</span>
<span class="org-builtin">read</span> n1
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 2 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Introduce el segundo numero: "</span>
<span class="org-builtin">read</span> n2
<span class="org-keyword">fi</span>

[[ $((n1 % n2)) -eq 0 ]] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Es divisible"</span> || <span class="org-builtin">echo</span> <span class="org-string">"No es divisible"</span>
</pre>
</div></li>

<li><p>
Escribe un script comprime.sh que nos guarde una copia de seguridad
de un directorio dado en un fichero dado. Los parámetros los
podremos pasar por línea de comando o bien solicitar al usuario. El
comando utilizará el programa tar, con las opción de compresión. El
script comprobará que el número de parámetros pasados es el
correcto y que el directorio existe. Si no se pasan parámetros el
programa entrará en modo interactivo, solicitando los parámetros al
usuario. El script irá guardando en un fichero copias<sub>seguridad.txt</sub>
el nombre de los ficheros comprimidos, de qué carpetas son y en qué
fecha se hizo.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">comprime.sh</span>
[[ $<span class="org-variable-name">#</span> -gt 2 ]] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Maximo 2 parametros"</span> &amp;&amp; <span class="org-keyword">exit</span> 1

<span class="org-variable-name">n1</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">n2</span>=$<span class="org-variable-name">2</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 1 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Directorio a comprimir: "</span>
<span class="org-builtin">read</span> n1
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 2 ]
<span class="org-keyword">then</span>
<span class="org-variable-name">n2</span>=<span class="org-string">"copia.tar"</span>
<span class="org-keyword">fi</span>

tar cf $<span class="org-variable-name">n2</span> $<span class="org-variable-name">n1</span>

<span class="org-builtin">echo</span> -e <span class="org-string">"Copia de:"</span> $(realpath $<span class="org-variable-name">n1</span>) <span class="org-string">"\nEn:"</span> $(realpath $<span class="org-variable-name">n2</span>) <span class="org-string">"\nA las:"</span> $(date) <span class="org-string">"\n"</span> <span class="org-sh-escaped-newline">\</span>
     &gt;&gt; $<span class="org-variable-name">HOME</span>/copias_seguridad.txt
</pre>
</div></li>

<li><p>
Escribe un script descomprime.sh que nos descomprima en contenido
de un fichero .tar en un directorio dado. El comando podrá
funcionar pasándole los parámetros por línea de comando o bien en
modo interactivo. Si se le pasa un número erróneo de parámetros nos
mostrará la ayuda del comando, si no se le pasan parámetros los
solicitará en modo interactivo. El comando debe comprobar que el
directorio existe (y es un directorio) y que el fichero .tar existe
y es un fichero.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">descomprime.sh</span>
[[ $<span class="org-variable-name">#</span> -gt 2 ]] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Maximo 2 parametros"</span> &amp;&amp; <span class="org-keyword">exit</span> 1

<span class="org-variable-name">n1</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">n2</span>=$<span class="org-variable-name">2</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 1 ]
<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Fichero a descomprimir: "</span>
<span class="org-builtin">read</span> n1
<span class="org-keyword">fi</span>

[[ -f $<span class="org-variable-name">n1</span> ]] || ( <span class="org-builtin">echo</span> <span class="org-string">"El comprimido no existe"</span> &amp;&amp; <span class="org-keyword">exit</span> 1 )

<span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -lt 2 ]
<span class="org-keyword">then</span>
<span class="org-variable-name">n2</span>=$(basename $<span class="org-variable-name">n1</span>)
<span class="org-variable-name">n2</span>=<span class="org-string">"${n2%.*}"</span>
mkdir -p $<span class="org-variable-name">n2</span>
<span class="org-keyword">fi</span>

[[ -d $<span class="org-variable-name">n2</span> ]] || ( <span class="org-builtin">echo</span> <span class="org-string">"El directorio no existe"</span> &amp;&amp; <span class="org-keyword">exit</span> 1 )

tar xf $<span class="org-variable-name">n1</span> -C $<span class="org-variable-name">n2</span>
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-org6542be6" class="outline-2">
<h2 id="org6542be6">Scripts Iniciales II</h2>
<div class="outline-text-2" id="text-org6542be6">
<ol class="org-ol">
<li><p>
Crear un script llamado borrar que se use asi: <code>./borrar.sh
   &lt;fichero&gt;</code>. Cuyo funcionamiento sea que mueva el fichero a la papelera de
reciclaje. La papelera de reciclaje tiene que estar en el
directorio home del usuario que ejecuta el script, y si no existe
la tiene que crear. Si se le pasa un número de argumentos distinto
de 1 saldrá un mensaje de error y dirá cómo hay que usar el
comando. El comando tiene que comprobar que el fichero existe antes
de moverlo a la papelera de reciclaje si no también mostrará un
mensaje de error.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">borrar.sh</span>
[[ $<span class="org-variable-name">#</span> -ne 1 ]] &amp;&amp; ( <span class="org-builtin">echo</span> <span class="org-string">"Iserta un parametro tonto"</span> &amp;&amp; <span class="org-keyword">exit</span> 1 )

[[ -f $<span class="org-variable-name">1</span> ]] || ( <span class="org-builtin">echo</span> <span class="org-string">"No existe el fichero"</span> &amp;&amp; <span class="org-keyword">exit</span> 1 )

<span class="org-variable-name">trash</span>=<span class="org-string">"$HOME/Trash"</span>
[[ -d $<span class="org-variable-name">trash</span> ]] || mkdir $<span class="org-variable-name">trash</span>

mv $<span class="org-variable-name">1</span> $<span class="org-variable-name">trash</span>
</pre>
</div></li>

<li><p>
Crear un script llamado vacia-papelera.sh que borre definitivamente
todos los ficheros de nuestra papelera. El script nos preguntará
antes si estamos seguros.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">vacia-papelera.sh</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Estas seguro? [s/n]:"</span>
<span class="org-builtin">read</span> seguro

[[ $<span class="org-variable-name">seguro</span> -eq <span class="org-string">"s"</span> ]] &amp;&amp; rm -rf <span class="org-string">"$HOME/Trash"</span> || <span class="org-builtin">echo</span> <span class="org-string">"Pues no la borro"</span>
</pre>
</div></li>

<li><p>
Crea un script datos<sub>usuario.sh</sub> que solicite un nombre de usuario
por línea de comando de forma interactiva y que nos muestre los
datos de dicho usuario extrayéndolos del fichero passwd en este
formato:
Login: pepe
Contraseña: x
UID: 1002
GID: 1002
Directorio home: /home/pepe
Datos del usuario: Pepe Pérez, 645363524,
Shell por defecto: /bin/bash
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">datos_usuario.sh</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"Mete el nombre de un usuario: "</span>
<span class="org-builtin">read</span> usuario

<span class="org-variable-name">datos</span>=$(grep $<span class="org-variable-name">usuario</span> /etc/passwd)
<span class="org-builtin">echo</span> <span class="org-string">"Login:"</span>             $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f1 -d:)
<span class="org-builtin">echo</span> <span class="org-string">"Contrasenia:"</span>       $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f2 -d:)
<span class="org-builtin">echo</span> <span class="org-string">"UID:"</span>               $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f3 -d:)
<span class="org-builtin">echo</span> <span class="org-string">"GID:"</span>               $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f4 -d:)
<span class="org-builtin">echo</span> <span class="org-string">"Datos del usuario:"</span> $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f5 -d:)
<span class="org-builtin">echo</span> <span class="org-string">"Directorio home:"</span>   $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f6 -d:)
<span class="org-builtin">echo</span> <span class="org-string">"Shell por defecto:"</span> $(<span class="org-builtin">echo</span> $<span class="org-variable-name">datos</span> | cut -f7 -d:)
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Alberto Robles Gomez</p>
<p class="date">Created: 2022-02-28 Mon 19:36</p>
</div>
</body>
</html>
